<section *ngIf="hasSearched" class="results-section">
  <header *ngIf="products.length" class="results-header">
    <h2>Search Results</h2>
    <p>
      {{ products.length }} product{{ products.length === 1 ? '' : 's' }} found
      <span *ngIf="query">for "{{ query }}"</span>
    </p>
  </header>

  <div *ngIf="products.length; else noResults" class="results-grid">
    <article
      *ngFor="let product of paginatedProducts; trackBy: trackByProductId; let idx = index"
      class="result-card"
    >
      <div class="result-card__media">
        <img
          *ngIf="shouldShowImage(product); else imagePlaceholder"
          [src]="getImageUrl(product)"
          [alt]="product.productDisplayName"
          loading="lazy"
          (error)="handleImageError(product.id)"
        />
        <ng-template #imagePlaceholder>
          <div class="result-card__placeholder">
            <span aria-hidden="true">[]</span>
            Image source pending
          </div>
        </ng-template>
      </div>

      <div class="result-card__content">
        <div class="result-card__meta">
          <span class="result-card__rank">#{{ (currentPage - 1) * pageSize + idx + 1 }}</span>
          <span class="result-card__score">
            {{ getSimilarityPercent(product.similarity) | number: '1.1-1' }}%
          </span>
        </div>
        <h3>{{ product.productDisplayName }}</h3>
        <p class="result-card__id">ID: {{ product.id }}</p>
        <div class="result-card__bar-track" role="presentation">
          <span
            class="result-card__bar-fill"
            [style.width.%]="getSimilarityPercent(product.similarity)"
          ></span>
        </div>
        <p class="result-card__similarity">
          Similarity: {{ product.similarity | number: '1.3-3' }}
        </p>
        <p class="result-card__confidence">
          {{ getConfidenceLabel(product.similarity) }}
        </p>
      </div>
    </article>
  </div>

  <nav *ngIf="totalPages > 1" class="results-pagination" aria-label="Search result pages">
    <p class="results-pagination__summary">
      Showing {{ displayStart }}-{{ displayEnd }} of {{ products.length }}
    </p>

    <div class="results-pagination__controls">
      <button
        type="button"
        class="results-pagination__nav-btn"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        Previous
      </button>

      <button
        *ngFor="let page of pageNumbers"
        type="button"
        class="results-pagination__page-btn"
        [class.results-pagination__page-btn--active]="page === currentPage"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>

      <button
        type="button"
        class="results-pagination__nav-btn"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        Next
      </button>
    </div>
  </nav>

  <ng-template #noResults>
    <p class="empty-state">
      No products found<span *ngIf="query"> for "{{ query }}"</span>.
    </p>
  </ng-template>
</section>
